<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BUnwarpJ image registration with DEMs • map.displ.r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BUnwarpJ image registration with DEMs">
<meta property="og:description" content="map.displ.r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">map.displ.r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1_BUnwarpJ_image_registration.html">BUnwarpJ image registration with DEMs</a>
    </li>
    <li>
      <a href="../articles/2_Visualizing_surface_displacements.html">Visualizing surface displacements from BUnwarpJ</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BUnwarpJ image registration with DEMs</h1>
                        <h4 class="author">Jason Goetz</h4>
            
            <h4 class="date">2020-10-01</h4>
      
      
      <div class="hidden name"><code>1_BUnwarpJ_image_registration.Rmd</code></div>

    </div>

    
    
<p>This vigenette is a short tutorial showing how to apply the <a href="https://imagej.net/BUnwarpJ">BUnwarpJ plugin</a> for performing image registration to digital elevation models (DEMs). An image registration maps the transformation of each pixel from a source image to a target image. In this example, we are mapping the sufrace displacement patterns of an active rock glacier using high-resolution (0.50 m x 0.50 m) DEMs.</p>
<div id="install-fiji" class="section level3">
<h3 class="hasAnchor">
<a href="#install-fiji" class="anchor"></a>Install Fiji</h3>
<p>Start by downloading and installing the open-source image processing software Fiji <a href="https://fiji.sc/" class="uri">https://fiji.sc/</a>, which already includes the BUnwarpJ plugin installed.</p>
</div>
<div id="open-hillshade-models" class="section level3">
<h3 class="hasAnchor">
<a href="#open-hillshade-models" class="anchor"></a>Open hillshade models</h3>
<p>We will use hillshade models derived from the DEMs to perform the registration. By using hillshade models, it is much easier for us to identify landmarks (i.e. boulders) that can help assist in the registration process.</p>
<p>In Fiji, go to <code>File &gt; Open</code> to load the hillshade models.</p>
<p>We need to remember the order the hillshade models were opened. The images need to be opened in this order when re-opening Fiji to continue working on a project. We will first open <code>rock_glacier_hillshade_2012_50cm.tif</code> and then <code>ock_glacier_hillshade_2017_50cm.tif</code>.</p>
<p>Note: Fiji may have trouble opening a GEOTIFF. It may appear as a blank (i.e. black) image when opened. To get around this, we can convert it to a PNG image format. We can use <a href="https://www.irfanview.net/">IrfanView</a> to do this, just make sure to save with no compression. As long as the row and columns are consistent with the original GEOTIFF, we will have no problem <a href="https://jngtz.github.io/map.displ.r/articles/2_Visualizing_surface_displacements.html#importing-bunwarpj-transformation-file">transforming</a> the resulting displacement map to local coordinate reference system.</p>
<p><img src="Fiji-toolbar.png" width="571" height="107"></p>
<p><img src="open_hillshade_2012.png" width="453" height="570"></p>
<p><img src="open_hillshade_2017.png" width="453" height="570"></p>
</div>
<div id="open-bunwarpj-plugin-and-map-landmarks" class="section level3">
<h3 class="hasAnchor">
<a href="#open-bunwarpj-plugin-and-map-landmarks" class="anchor"></a>Open bunwarpJ plugin and map landmarks</h3>
<p>Now we will will open the bUnwarpJ plugin for performing non-rigid image registration using b-splines,</p>
<p><code>Plugins &gt; Registration &gt; bUnwarpJ</code></p>
<p>Similar to georeferencing images in a GIS, we will map landmarks in the 2012 and 2017 hillshade models to help with the registration process. For the rock glaicer, we will map landmarks in active and stable areas of the scene.</p>
<p><img src="bunwarpj_toolbar.png" width="571" height="107"></p>
<p><img src="landmark_all_hillshade_2012.png" width="673" height="828"></p>
<p><img src="landmark_all_hillshade_2017.png" width="673" height="828"></p>
</div>
<div id="save-landmarks" class="section level3">
<h3 class="hasAnchor">
<a href="#save-landmarks" class="anchor"></a>Save landmarks</h3>
<p>Don’t forget to save the landmarks we just mapped,</p>
<p><code>I/O Menu &gt; Save Landmarks As…</code></p>
<p>We should use a filename to remember the direction of mapping, e.g., <code>Landmarks_source2012_to_target2017.txt</code>.</p>
<p><img src="bunwarpj_io_menu.png" width="313" height="514"></p>
<p>Note: When loading landmarks, make sure that source image is the 2012 hillshade and the target image is the 2017 hillshade, otherwise the landmarks will not be positioned correctly.</p>
</div>
<div id="run-registration" class="section level3">
<h3 class="hasAnchor">
<a href="#run-registration" class="anchor"></a>Run registration</h3>
<p>Now we can run the registration. We can use the following settings. By mapping/loading landmarks, they will be automatically used for the registration.</p>
<p><img src="bunwarpj_settings.png" width="413" height="518"></p>
<p>A <code>Save transformation task</code> will pop up when registration is complete.</p>
</div>
<div id="convert-transformation-to-raw" class="section level3">
<h3 class="hasAnchor">
<a href="#convert-transformation-to-raw" class="anchor"></a>Convert transformation to RAW</h3>
<p>This transformation file can be <a href="https://jngtz.github.io/map.displ.r/articles/2_Visualizing_surface_displacements.html#importing-bunwarpj-transformation-file">opened in R</a>.</p>
<p>Select <code>I/O Menu &gt; Convert Transformation to RAW</code></p>
<ol style="list-style-type: decimal">
<li>First select the transformation file</li>
<li>Write the filename – can be confusing because it says OPEN instead of convert/save</li>
</ol>
<p><img src="convert_direct_to_raw_select_elastic.png" width="502" height="358"></p>
<p><img src="convert_direct_to_raw_output_filename.png" width="502" height="358"></p>
<p>Now we can use R for <a href="https://jngtz.github.io/map.displ.r/articles/2_Visualizing_surface_displacements.html">transforming the image registration to a local CRS and visualizing the mapped surface displacement results</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jason Goetz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
